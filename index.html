<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Pythagorean Theorem Visualiser</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<style>
			body {
				font-family: "Inter", sans-serif;
				overscroll-behavior-y: contain;
			}
			canvas {
				touch-action: none;
			}
			/* Simple toggle switch styling */
			.toggle-checkbox:checked {
				right: 0;
				border-color: #4f46e5;
			}
			.toggle-checkbox:checked + .toggle-label {
				background-color: #4f46e5;
			}
		</style>
	</head>
	<body class="flex flex-col h-screen bg-gray-50 text-gray-800 antialiased">
		<header class="bg-white shadow-md p-4 z-10">
			<div class="max-w-7xl mx-auto text-center">
				<h1 class="text-2xl md:text-3xl font-bold text-gray-900">
					Interactive Pythagorean Theorem Visualizer
				</h1>
				<p class="text-sm md:text-md text-blue-600">
					A tool for GCSE & A-Level Students
				</p>
			</div>
		</header>

		<main
			class="flex-grow flex flex-col lg:flex-row items-center justify-center p-4 md:p-8 space-y-4 lg:space-y-0 lg:space-x-8 overflow-hidden"
		>
			<div
				class="w-full lg:w-2/3 h-2/5 lg:h-full max-w-3xl bg-white rounded-2xl shadow-lg border border-gray-200 cursor-grab active:cursor-grabbing"
			>
				<canvas id="visualizerCanvas"></canvas>
			</div>

			<div
				class="w-full lg:w-1/3 h-3/5 lg:h-auto max-w-md p-6 bg-white rounded-2xl shadow-lg border border-gray-200 overflow-y-auto"
			>
				<h2 class="text-xl font-semibold mb-2 text-center">
					Adjust & Explore
				</h2>
				<p class="text-center text-gray-500 mb-4">
					Drag to pan, scroll or pinch to zoom.
				</p>

				<div class="mb-6">
					<label
						for="sliderA"
						class="flex justify-between items-center text-lg font-medium text-red-600"
					>
						<span>Side a</span>
						<span
							id="valueA"
							class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-base font-semibold"
							>30</span
						>
					</label>
					<input
						id="sliderA"
						type="range"
						min="1"
						max="100"
						value="30"
						class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer"
					/>
				</div>

				<div class="mb-6">
					<label
						for="sliderB"
						class="flex justify-between items-center text-lg font-medium text-green-600"
					>
						<span>Side b</span>
						<span
							id="valueB"
							class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-base font-semibold"
							>40</span
						>
					</label>
					<input
						id="sliderB"
						type="range"
						min="1"
						max="100"
						value="40"
						class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer"
					/>
				</div>

				<!-- Toggle Switch for Squares -->
				<div class="flex items-center justify-between mt-6">
					<label
						for="showSquaresToggle"
						class="text-lg font-medium text-gray-700"
						>Show Squares</label
					>
					<div
						class="relative inline-block w-12 mr-2 align-middle select-none transition duration-200 ease-in"
					>
						<input
							type="checkbox"
							name="toggle"
							id="showSquaresToggle"
							class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-4 appearance-none cursor-pointer"
							checked
						/>
						<label
							for="showSquaresToggle"
							class="toggle-label block overflow-hidden h-7 rounded-full bg-gray-300 cursor-pointer"
						></label>
					</div>
				</div>

				<div class="mt-6 border-t pt-4">
					<p
						class="text-lg font-medium text-gray-700 text-center mb-3"
					>
						Label Controls
					</p>
					<div class="grid grid-cols-3 gap-2">
						<button
							id="toggleA"
							class="p-2 bg-red-100 text-red-700 font-semibold rounded-lg border-2 border-red-200 transition"
						>
							Hide a
						</button>
						<button
							id="toggleB"
							class="p-2 bg-green-100 text-green-700 font-semibold rounded-lg border-2 border-green-200 transition"
						>
							Hide b
						</button>
						<button
							id="toggleC"
							class="p-2 bg-blue-100 text-blue-700 font-semibold rounded-lg border-2 border-blue-200 transition"
						>
							Hide c
						</button>
					</div>
				</div>

				<div
					class="text-center bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg mt-8"
				>
					<h3 class="text-lg font-semibold text-gray-800 mb-2">
						The Theorem in Action
					</h3>
					<div id="calculation-container" class="text-left">
						<div
							id="main-formula"
							class="text-center text-xl md:text-2xl font-mono bg-white p-3 rounded-lg shadow-inner"
						>
							<span class="text-red-600">a²</span> +
							<span class="text-green-600">b²</span> =
							<span class="text-blue-600">c²</span>
						</div>
						<div
							id="formulaValues"
							class="text-left font-mono mt-3 text-gray-600 break-words space-y-1"
						></div>
						<div
							id="formulaResult"
							class="text-left font-mono mt-2 text-gray-600 break-words"
						></div>
						<div id="reveal-container" class="mt-4 hidden">
							<button
								id="revealCalcBtn"
								class="w-full text-indigo-700 bg-indigo-100 p-2 rounded-md hover:bg-indigo-200 transition"
							>
								Reveal Calculation
							</button>
						</div>
					</div>
				</div>
			</div>
		</main>

		<footer
			class="bg-white text-center text-sm text-gray-500 p-4 border-t border-gray-200"
		>
			<p>
				&copy; <span id="year"></span> | A project by
				<a
					href="https://twitter.com/alvlmathteacher"
					target="_blank"
					rel="noopener noreferrer"
					class="text-indigo-600 hover:underline"
					>alvlmathteacher</a
				>
			</p>
		</footer>

		<script>
			document.addEventListener("DOMContentLoaded", () => {
				const canvas = document.getElementById("visualizerCanvas");
				const ctx = canvas.getContext("2d");
				const sliderA = document.getElementById("sliderA");
				const sliderB = document.getElementById("sliderB");
				const valueA = document.getElementById("valueA");
				const valueB = document.getElementById("valueB");
				const showSquaresToggle =
					document.getElementById("showSquaresToggle");
				const formulaValues = document.getElementById("formulaValues");
				const formulaResult = document.getElementById("formulaResult");
				const toggleA = document.getElementById("toggleA");
				const toggleB = document.getElementById("toggleB");
				const toggleC = document.getElementById("toggleC");
				const revealContainer =
					document.getElementById("reveal-container");
				const revealCalcBtn = document.getElementById("revealCalcBtn");
				document.getElementById("year").textContent =
					new Date().getFullYear();

				// --- State ---
				let a = +sliderA.value;
				let b = +sliderB.value;
				let showSquares = showSquaresToggle.checked;
				let hiddenLabel = null; // can be 'a', 'b', or 'c'

				// --- Transformation State ---
				let scale = 2.5;
				let offsetX = 0;
				let offsetY = 0;
				let isDragging = false;
				let lastX = 0;
				let lastY = 0;
				let initialPinchDistance = null;
				let lastScale = 1;

				function resizeCanvas() {
					const parent = canvas.parentElement;
					canvas.width = parent.clientWidth * window.devicePixelRatio;
					canvas.height =
						parent.clientHeight * window.devicePixelRatio;
					canvas.style.width = `${parent.clientWidth}px`;
					canvas.style.height = `${parent.clientHeight}px`;
					if (!offsetX && !offsetY) {
						offsetX = canvas.width / 2;
						offsetY = canvas.height * 0.75;
					}
					draw();
				}

				// --- Main Drawing Logic ---
				function draw() {
					ctx.clearRect(0, 0, canvas.width, canvas.height);
					ctx.save();
					ctx.translate(offsetX, offsetY);
					ctx.scale(scale, scale);

					const c = Math.sqrt(a * a + b * b);
					const angle = Math.atan2(-a, b);

					if (showSquares) {
						ctx.lineWidth = 2 / scale;
						ctx.fillStyle = "rgba(16, 185, 129, 0.6)";
						ctx.strokeStyle = "rgb(5, 150, 105)";
						ctx.fillRect(-b, 0, b, b);
						ctx.strokeRect(-b, 0, b, b);

						ctx.fillStyle = "rgba(239, 68, 68, 0.6)";
						ctx.strokeStyle = "rgb(220, 38, 38)";
						ctx.fillRect(0, -a, a, a);
						ctx.strokeRect(0, -a, a, a);

						ctx.save();
						ctx.translate(-b, 0);
						ctx.rotate(angle);
						ctx.fillStyle = "rgba(59, 130, 246, 0.6)";
						ctx.strokeStyle = "rgb(37, 99, 235)";
						ctx.fillRect(0, -c, c, c);
						ctx.strokeRect(0, -c, c, c);
						ctx.restore();
					}

					ctx.beginPath();
					ctx.moveTo(0, 0);
					ctx.lineTo(-b, 0);
					ctx.lineTo(0, -a);
					ctx.closePath();
					ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
					ctx.fill();

					ctx.lineWidth = Math.max(1.5, Math.min(5, c / 40)) / scale;
					ctx.beginPath();
					ctx.moveTo(0, 0);
					ctx.lineTo(-b, 0);
					ctx.strokeStyle = "rgb(5, 150, 105)";
					ctx.stroke();
					ctx.beginPath();
					ctx.moveTo(0, 0);
					ctx.lineTo(0, -a);
					ctx.strokeStyle = "rgb(220, 38, 38)";
					ctx.stroke();
					ctx.beginPath();
					ctx.moveTo(-b, 0);
					ctx.lineTo(0, -a);
					ctx.strokeStyle = "rgb(37, 99, 235)";
					ctx.stroke();

					ctx.font = `bold ${60 / scale}px sans-serif`;
					ctx.textAlign = "center";
					ctx.textBaseline = "middle";

					const formatNumber = (num) =>
						num % 1 === 0 ? num.toFixed(0) : num.toFixed(1);

					if (hiddenLabel !== "a") {
						ctx.save();
						ctx.translate(30 / scale, -a / 2);
						ctx.rotate(Math.PI / 2);
						ctx.fillStyle = "rgb(220, 38, 38)";
						ctx.fillText(formatNumber(a), 0, 0);
						ctx.restore();
					}

					if (hiddenLabel !== "b") {
						ctx.fillStyle = "rgb(5, 150, 105)";
						ctx.fillText(formatNumber(b), -b / 2, 30 / scale);
					}

					if (hiddenLabel !== "c") {
						ctx.save();
						ctx.translate(-b / 2, -a / 2);
						ctx.rotate(angle);
						ctx.fillStyle = "rgb(37, 99, 235)";
						ctx.fillText(formatNumber(c), 0, -30 / scale);
						ctx.restore();
					}

					ctx.restore();
				}

				function updateUI() {
					a = +sliderA.value;
					b = +sliderB.value;
					valueA.textContent = a;
					valueB.textContent = b;

					updateCalculationBox();
					updateToggleButtons();
					draw();
				}

				function updateCalculationBox() {
					const c = Math.sqrt(a * a + b * b);
					const aSq = a * a;
					const bSq = b * b;
					const cSq = c * c;

					revealContainer.classList.add("hidden");
					formulaValues.classList.remove("text-center");
					formulaResult.classList.remove("text-center");

					if (hiddenLabel === null) {
						formulaValues.innerHTML = `<span class="text-red-600">${a}²</span> + <span class="text-green-600">${b}²</span> = <span class="text-blue-600">${c.toFixed(
							2
						)}²</span>`;
						formulaResult.innerHTML = `<span class="text-red-600">${aSq}</span> + <span class="text-green-600">${bSq}</span> = <span class="text-blue-600">${cSq.toFixed(
							0
						)}</span>`;
					} else {
						formulaResult.innerHTML = "";
						revealContainer.classList.remove("hidden");
						if (hiddenLabel === "c") {
							formulaValues.innerHTML = "c = √(a² + b²)";
						} else if (hiddenLabel === "a") {
							formulaValues.innerHTML = "a = √(c² - b²)";
						} else if (hiddenLabel === "b") {
							formulaValues.innerHTML = "b = √(c² - a²)";
						}
					}
				}

				function updateToggleButtons() {
					toggleA.textContent =
						hiddenLabel === "a" ? "Show a" : "Hide a";
					toggleB.textContent =
						hiddenLabel === "b" ? "Show b" : "Hide b";
					toggleC.textContent =
						hiddenLabel === "c" ? "Show c" : "Hide c";
				}

				function handleToggle(label) {
					if (hiddenLabel === label) {
						hiddenLabel = null;
					} else {
						hiddenLabel = label;
					}
					updateToggleButtons();
					updateCalculationBox();
					draw();
				}

				function revealCalculation() {
					const c = Math.sqrt(a * a + b * b);
					const aSq = a * a;
					const bSq = b * b;
					const cSq = c * c;
					let steps = "";

					if (hiddenLabel === "c") {
						steps = `c = √(${a}² + ${b}²)<br>`;
						steps += `c = √(${aSq} + ${bSq})<br>`;
						steps += `c = √(${cSq.toFixed(2)})<br>`;
						steps += `c = ${c.toFixed(2)}`;
					} else if (hiddenLabel === "a") {
						steps = `a = √(${c.toFixed(2)}² - ${b}²)<br>`;
						steps += `a = √(${cSq.toFixed(2)} - ${bSq})<br>`;
						steps += `a = √(${(cSq - bSq).toFixed(2)})<br>`;
						steps += `a = ${a.toFixed(2)}`;
					} else if (hiddenLabel === "b") {
						steps = `b = √(${c.toFixed(2)}² - ${a}²)<br>`;
						steps += `b = √(${cSq.toFixed(2)} - ${aSq})<br>`;
						steps += `b = √(${(cSq - aSq).toFixed(2)})<br>`;
						steps += `b = ${b.toFixed(2)}`;
					}

					formulaValues.innerHTML = steps;
					formulaResult.innerHTML = "";
					revealContainer.classList.add("hidden");
				}

				function handlePan(dx, dy) {
					offsetX += dx;
					offsetY += dy;
					draw();
				}

				function handleZoom(delta, centerX, centerY) {
					const scaleAmount = 1.1;
					const worldX =
						(centerX * window.devicePixelRatio - offsetX) / scale;
					const worldY =
						(centerY * window.devicePixelRatio - offsetY) / scale;
					scale *= delta < 0 ? scaleAmount : 1 / scaleAmount;
					offsetX =
						centerX * window.devicePixelRatio - worldX * scale;
					offsetY =
						centerY * window.devicePixelRatio - worldY * scale;
					draw();
				}

				// --- Event Listeners ---
				sliderA.addEventListener("input", updateUI);
				sliderB.addEventListener("input", updateUI);
				showSquaresToggle.addEventListener("change", () => {
					showSquares = showSquaresToggle.checked;
					draw();
				});

				toggleA.addEventListener("click", () => handleToggle("a"));
				toggleB.addEventListener("click", () => handleToggle("b"));
				toggleC.addEventListener("click", () => handleToggle("c"));
				revealCalcBtn.addEventListener("click", revealCalculation);

				canvas.addEventListener("mousedown", (e) => {
					isDragging = true;
					lastX = e.clientX;
					lastY = e.clientY;
				});
				canvas.addEventListener("mouseup", () => (isDragging = false));
				canvas.addEventListener(
					"mouseleave",
					() => (isDragging = false)
				);
				canvas.addEventListener("mousemove", (e) => {
					if (isDragging) {
						handlePan(e.clientX - lastX, e.clientY - lastY);
						lastX = e.clientX;
						lastY = e.clientY;
					}
				});
				canvas.addEventListener(
					"wheel",
					(e) => {
						e.preventDefault();
						const rect = canvas.getBoundingClientRect();
						handleZoom(
							e.deltaY,
							e.clientX - rect.left,
							e.clientY - rect.top
						);
					},
					{ passive: false }
				);
				canvas.addEventListener("touchstart", (e) => {
					if (e.touches.length === 1) {
						isDragging = true;
						lastX = e.touches[0].clientX;
						lastY = e.touches[0].clientY;
					} else if (e.touches.length === 2) {
						isDragging = false;
						initialPinchDistance = Math.hypot(
							e.touches[0].clientX - e.touches[1].clientX,
							e.touches[0].clientY - e.touches[1].clientY
						);
						lastScale = scale;
					}
				});
				canvas.addEventListener("touchend", () => {
					isDragging = false;
					initialPinchDistance = null;
				});
				canvas.addEventListener(
					"touchmove",
					(e) => {
						e.preventDefault();
						if (isDragging && e.touches.length === 1) {
							handlePan(
								e.touches[0].clientX - lastX,
								e.touches[0].clientY - lastY
							);
							lastX = e.touches[0].clientX;
							lastY = e.touches[0].clientY;
						} else if (
							initialPinchDistance &&
							e.touches.length === 2
						) {
							const newPinchDistance = Math.hypot(
								e.touches[0].clientX - e.touches[1].clientX,
								e.touches[0].clientY - e.touches[1].clientY
							);
							const scaleFactor =
								newPinchDistance / initialPinchDistance;
							const newScale = lastScale * scaleFactor;
							const rect = canvas.getBoundingClientRect();
							const midX =
								(e.touches[0].clientX + e.touches[1].clientX) /
									2 -
								rect.left;
							const midY =
								(e.touches[0].clientY + e.touches[1].clientY) /
									2 -
								rect.top;
							const oldScale = scale;
							scale = newScale;
							offsetX -=
								midX *
								window.devicePixelRatio *
								(1 / oldScale - 1 / newScale) *
								oldScale;
							offsetY -=
								midY *
								window.devicePixelRatio *
								(1 / oldScale - 1 / newScale) *
								oldScale;
							draw();
						}
					},
					{ passive: false }
				);
				window.addEventListener("resize", resizeCanvas);
				resizeCanvas();
				updateUI();
			});
		</script>
	</body>
</html>
